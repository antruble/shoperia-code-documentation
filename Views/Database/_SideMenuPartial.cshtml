@model ShoperiaDocumentation.Models.ViewModels.DatabaseViewModel

@{

}
<div class="w-1/5 pt-4 px-2 flex flex-col bg-indigo-950 text-slate-200 text-md" id="database-explorer">
        <div class="relative pb-4">
            <input type="text"
                    id="searchBar"
                    placeholder="Search..."
                    class="w-full py-2 px-4 rounded-md border border-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-700 text-black"
                    oninput="handleSearchInput(event)" />
        </div>
        <div class="flex flex-col gap-1 overflow-y-scroll ">
            @if (Model != null && Model.Entities != null)
            {
                @foreach (var entity in Model.Entities)
                {
                <div class="menu-entity cursor-pointer hover:bg-indigo-700 px-2 py-1 rounded"
                     data-entity-id="@entity.Id">
                    @entity.Name
                </div>
                }
            }
        </div>
</div>


<script>
    const entityMenus = document.querySelectorAll('.menu-entity');
    const entityDetails = document.getElementById('entity-data');

    entityMenus.forEach((entity) => {
        entity.addEventListener('click', async () => {
            const entityId = entity.getAttribute('data-entity-id'); // Az entitás ID-ja
            try {
                // AJAX hívás az entitás adataihoz
                const response = await fetch(`/database/entities/${entityId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch entity details.');
                }

                const data = await response.json(); // JSON adat feldolgozása

                console.log(data);
                // Entitás adatok frissítése a megjelenítéshez
                const entityDetails = document.getElementById('entity-data');
                entityDetails.innerHTML = `
                        <p><strong>Name:</strong> ${data.name}</p>
                        <p><strong>Description:</strong> ${data.description || 'N/A'}</p>
                        <p><strong>Fields:</strong></p>
                        <ul>
                            ${data.fields?.map(field => `<li>${field}</li>`).join('') || '<li>No fields available</li>'}
                        </ul>
                    `;
            } catch (error) {
                console.error('Error fetching entity details:', error);
                alert('An error occurred while fetching the entity details.');
            }
        });
    });
    // Keresés kezelése
    function handleSearchInput(event) {
        const query = event.target.value.toLowerCase();

        entityMenus.forEach((item) => {
            const text = item.textContent.toLowerCase();
            if (text.includes(query)) {
                item.style.display = 'block'; // Megjelenítés, ha illeszkedik
            } else {
                item.style.display = 'none'; // Elrejtés, ha nem illeszkedik
            }
        });
    }

    // Keresés törlése
    function clearSearch() {
        const searchBar = document.getElementById('searchBar');
        searchBar.value = ''; // Mező törlése
        handleSearchInput({ target: searchBar }); // Frissítés üres szöveggel
    }


</script>

